{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block content %}
<!-- 频道导航 -->
<section class="channel-navigation">
    <div class="container">
        <div class="channel-tabs" id="channelTabs">
            <button class="channel-tab active" data-channel="all">全部</button>
            {% for channel in channels %}
            <button class="channel-tab channel-item" data-channel="{{ channel.slug }}" style="display: none;">{{ channel.name }}</button>
            {% endfor %}
            
            <div class="channel-more" id="channelMore" style="display: none;">
                <button class="channel-tab more-btn" id="moreChannelsBtn">
                    更多 <i class="fas fa-chevron-down"></i>
                </button>
            </div>
        </div>
    </div>
</section>

<!-- 频道下拉菜单 - 移到body层级 -->
<div class="channel-dropdown" id="channelDropdown">
    <!-- 动态生成的下拉菜单内容 -->
</div>

<!-- 主要内容区域 -->
<div class="main-content">
    <div class="container">
        <div class="content-grid">
            <!-- 左侧主要内容 -->
            <div class="content-main">
                <h2 class="section-title">今日必读</h2>
                
                <!-- 主要文章网格 -->
                <div class="main-articles-grid">
                    {% if featured %}
                        <div class="hero-slider">
                            {% for article in featured %}
                            <div class="hero-slide {% if forloop.first %}active{% endif %}">
                                <div class="article-image">
                                    {% if article.hero_image %}
                                        {% image article.hero_image fill-800x500 %}
                                    {% else %}
                                        <div class="article-placeholder">
                                            <i class="fas fa-newspaper"></i>
                                        </div>
                                    {% endif %}
                                    <div class="slide-overlay">
                                        <div class="slide-meta">
                                            <span class="slide-category">{{ article.channels.first.name|default:"新闻" }}</span>
                                            <span class="slide-time">{{ article.date|date:"M d, Y" }}</span>
                                        </div>
                                        <h3 class="slide-title">
                                            <a href="{{ article.custom_url }}">{{ article.title }}</a>
                                        </h3>
                                        <div class="slide-author">
                                            <span class="author-name">编辑</span>
                                            <span class="author-title">编辑</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            
                            <!-- 轮播指示器 -->
                            <div class="slider-indicators">
                                {% for article in featured %}
                                <button class="indicator {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.counter0 }}"></button>
                                {% endfor %}
                            </div>
                            
                            <!-- 轮播控制按钮 -->
                            <button class="slider-btn prev-btn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="slider-btn next-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    {% else %}
                        <p>暂无精选文章</p>
                    {% endif %}
                </div>

                <!-- 新闻网格 - 三列两行 -->
                <div class="news-grid-section">
                    <h3 class="subsection-title">热点新闻</h3>
                    <div class="news-grid-3x2">
                        {% if modules.0.items %}
                            {% for article in modules.0.items|slice:":6" %}
                            <article class="news-grid-item">
                                <div class="news-grid-image">
                                    {% if article.hero_image %}
                                        {% image article.hero_image fill-200x150 %}
                                    {% else %}
                                        <div class="news-grid-placeholder">
                                            <i class="fas fa-newspaper"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="news-grid-content">
                                    <h4 class="news-grid-title">
                                        <a href="{{ article.custom_url }}">{{ article.title }}</a>
                                    </h4>
                                    <div class="news-grid-meta">
                                        <span class="news-grid-category">{{ article.channels.first.name|default:"新闻" }}</span>
                                        <span class="news-grid-time">{{ article.date|date:"M d" }}</span>
                                    </div>
                                </div>
                            </article>
                            {% endfor %}
                        {% else %}
                            <p>暂无热点新闻</p>
                        {% endif %}
                    </div>
                </div>

                <!-- 最新新闻 -->
                <div class="latest-news">
                    <h3 class="subsection-title">最新新闻</h3>
                    <div class="news-grid">
                        {% if modules.0.items %}
                            {% for article in modules.0.items %}
                            <article class="news-item">
                                <div class="news-image">
                                    {% if article.hero_image %}
                                        {% image article.hero_image fill-300x200 %}
                                    {% else %}
                                        <div class="news-placeholder">
                                            <i class="fas fa-newspaper"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="news-content">
                                    <div class="news-meta">
                                        <span class="category">{{ article.channels.first.name|default:"新闻" }}</span>
                                    </div>
                                    <h4 class="news-title">
                                        <a href="{{ article.custom_url }}">{{ article.title }}</a>
                                    </h4>
                                </div>
                            </article>
                            {% endfor %}
                        {% else %}
                            <p>暂无最新新闻</p>
                        {% endif %}
                    </div>
                </div>

                <!-- 创意作品展示 -->
                <div class="creative-works">
                    <h3 class="subsection-title">创意作品</h3>
                    <div class="works-grid">
                        {% if creative_works %}
                            {% for work in creative_works %}
                            <div class="work-item">
                                {% if work.hero_image %}
                                <div class="work-image">
                                    {% image work.hero_image fill-300x200 %}
                                </div>
                                {% else %}
                                <div class="work-placeholder">
                                    <i class="fas fa-palette"></i>
                                </div>
                                {% endif %}
                                <div class="work-info">
                                    <h4 class="work-title">
                                        <a href="{{ work.url }}">{{ work.title }}</a>
                                    </h4>
                                    <p class="work-agency">{{ work.agency|default:"未知机构" }}</p>
                                    <p class="work-client">{{ work.client|default:"未知客户" }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p>暂无创意作品</p>
                        {% endif %}
                    </div>
                </div>

                <!-- 行业活动 -->
                <div class="events-section">
                    <h3 class="subsection-title">即将举行的活动</h3>
                    <div class="events-list">
                        {% if upcoming_events %}
                            {% for event in upcoming_events %}
                            <div class="event-item">
                                <div class="event-date">
                                    <span class="day">{{ event.event_date|date:"d" }}</span>
                                    <span class="month">{{ event.event_date|date:"M" }}</span>
                                </div>
                                <div class="event-info">
                                    <h4 class="event-title">
                                        <a href="{{ event.url }}">{{ event.title }}</a>
                                    </h4>
                                    <p class="event-location">{{ event.location|default:"地点待定" }}</p>
                                    <p class="event-organizer">{{ event.organizer|default:"主办方待定" }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p>暂无即将举行的活动</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- 右侧边栏 -->
            <div class="content-sidebar">
                <h3 class="sidebar-title">最受欢迎</h3>
                
                <!-- 热门文章列表 -->
                <div class="popular-articles">
                    {% if modules.0.items %}
                        {% for article in modules.0.items|slice:":8" %}
                        <div class="popular-item">
                            <span class="popular-category">{{ article.channels.first.name|default:"新闻" }}</span>
                            <h4 class="popular-title">
                                <a href="{{ article.custom_url }}">{{ article.title }}</a>
                            </h4>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p>暂无热门文章</p>
                    {% endif %}
                </div>

                <!-- 最新讨论 -->
                <div class="sidebar-widget">
                    <h3 class="widget-title">最新讨论</h3>
                    <div class="discussions-list">
                        {% if latest_discussions %}
                            {% for discussion in latest_discussions %}
                            <div class="discussion-item">
                                <h4 class="discussion-title">
                                    <a href="#">{{ discussion.title }}</a>
                                </h4>
                                <div class="discussion-meta">
                                    <span class="author">{{ discussion.author.username|default:"匿名用户" }}</span>
                                    <span class="replies">{{ discussion.replies_count|default:0 }} 回复</span>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p>暂无最新讨论</p>
                        {% endif %}
                    </div>
                </div>

                <!-- 研究报告 -->
                <div class="sidebar-widget">
                    <h3 class="widget-title">最新报告</h3>
                    <div class="reports-list">
                        {% if latest_reports %}
                            {% for report in latest_reports %}
                            <div class="report-item">
                                <h4 class="report-title">
                                    <a href="{{ report.url }}">{{ report.title }}</a>
                                </h4>
                                <p class="report-author">{{ report.author|default:"未知作者" }}</p>
                                {% if report.is_free %}
                                <span class="report-free">免费</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <p>暂无最新报告</p>
                        {% endif %}
                    </div>
                </div>

                <!-- 订阅区域 -->
                <div class="sidebar-widget newsletter-widget">
                    <h3 class="widget-title">订阅我们的新闻</h3>
                    <p class="widget-description">获取最新的行业新闻和创意灵感</p>
                    <form class="newsletter-form">
                        <input type="email" placeholder="输入您的邮箱地址" class="newsletter-input">
                        <button type="submit" class="newsletter-btn">订阅</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 底部特色内容 -->
<section class="featured-section">
    <div class="container">
        <h2 class="section-title">精选内容</h2>
        <div class="featured-grid">
            {% for module in modules %}
            {% if forloop.counter > 1 %}
            <div class="featured-module">
                <h3 class="module-title">{{ module.title }}</h3>
                <div class="module-items">
                    {% for item in module.items %}
                    <div class="module-item">
                        {% if item.hero_image %}
                        <div class="item-image">
                            {% image item.hero_image fill-200x150 %}
                        </div>
                        {% else %}
                        <div class="item-placeholder">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        {% endif %}
                        <div class="item-content">
                            <h4 class="item-title">
                                <a href="{{ item.url }}">{{ item.title }}</a>
                            </h4>
                            <span class="item-date">{{ item.date|date:"M d" }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
